App.controller("PlanController",["$scope","$filter","$timeout",function(e,n,a){function t(e){new ImgTouchCanvas({canvas:l,path:e}),$("#canvas").addClass("active")}function r(){var e=$(".canvaswrap");l.width=e.width(),l.height=e.height()}function i(e){for(var n in e)if(e[n])return!1;return!0}e.plans=PlanConfig,e.floors=[],e.step=0;var o=[],l=document.getElementById("canvas");e.filters={area:{min:55,max:90},type:{},direction:{}};for(var s=$(".plans ul"),c=e.plans.area.min;c<=PlanConfig.area.max;c+=PlanConfig.area.step)o.push(c);o.reduce(function(e,n){return e[n]=n,e},{});e.area=o,e.modal=e.plans.data[0],ons.ready(function(){for(var n=0;n<e.plans.floor;n++)e.floors[n]=n+1;e.floors.reverse(),setTimeout(function(){$(".bg-plan").addClass("active"),s.masonry({itemSelector:"li",transitionDuration:0}),$(".nstSlider").nstSlider({left_grip_selector:".leftGrip",right_grip_selector:".rightGrip",value_bar_selector:".bar",value_changed_callback:function(n,a,t){$(this).parent().find(".leftLabel").text(a),$(this).parent().find(".rightLabel").text(t),e.$apply(function(){e.filters.area.min=a,e.filters.area.max=t,e.changed()})}}),$(window).on("resize",function(){s.masonry("reload"),r(),t(e.modal.src)}),tabbar.on("prechange",function(e){$("#planBtn").hasClass("active")&&3==e.index&&e.cancel()}),r()},200)}),e.check_type=function(n,a){var t=angular.element(event.target);t.toggleClass("active"),e.filters.type[a]=e.filters.type[a]&&"undefined"!==e.filters.type[a]?!1:!0,e.changed()},e.check_direction=function(n,a){var t=angular.element(event.target);t.toggleClass("active"),e.filters.direction[a]=e.filters.direction[a]&&"undefined"!==e.filters.direction[a]?!1:!0,e.changed()},e.filterByArea=function(n){return e.filters.area.max>n.score&&n.score>e.filters.area.min?!0:!1},e.filterByType=function(n){return e.filters.type[n.type]||i(e.filters.type)},e.filterByDirection=function(n){return e.filters.direction[n.direction]||i(e.filters.direction)},e.changed=function(){a(function(){s.masonry("reload"),$(".plans li").last().stop(!0,!0).bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){s.masonry("reload")})},500)},e.trigger_modal=function(n){var a=0;for(var i in e.plans.data)n==e.plans.data[i].plan&&(a=i);$("#modal").addClass("active"),e.modal=e.plans.data[a],e.modalopen=!0,setTimeout(function(){r(),t(e.modal.src)},300)},e.close_modal=function(){$("#modal").removeClass("active"),e.modalopen=!1,$("#canvas").removeClass("active")}}]);