App.controller("PlanController",["$scope","$filter",function(e){function t(e){new ImgTouchCanvas({canvas:i,path:e}),$("#canvas").addClass("active")}function n(){var e=$(".canvaswrap");i.width=e.width(),i.height=e.height()}function a(e){for(var t in e)if(e[t])return!1;return!0}e.plans=PlanConfig,e.floors=[],e.step=0;var r=[],i=document.getElementById("canvas");e.filters={area:{min:55,max:90},type:{},direction:{}};for(var o=$(".plans ul"),l=e.plans.area.min;l<=PlanConfig.area.max;l+=PlanConfig.area.step)r.push(l);r.reduce(function(e,t){return e[t]=t,e},{});e.area=r,e.modal=e.plans.data[0],ons.ready(function(){for(var a=0;a<e.plans.floor;a++)e.floors[a]=a+1;e.floors.reverse(),setTimeout(function(){$(".bg-plan").addClass("active"),o.masonry({itemSelector:"li",transitionDuration:.2}),$(".nstSlider").nstSlider({left_grip_selector:".leftGrip",right_grip_selector:".rightGrip",value_bar_selector:".bar",value_changed_callback:function(t,n,a){$(this).parent().find(".leftLabel").text(n),$(this).parent().find(".rightLabel").text(a),e.$apply(function(){e.filters.area.min=n,e.filters.area.max=a,e.changed()})}}),$(window).on("resize",function(){e.changed(),n(),t(e.modal.src)}),tabbar.on("prechange",function(e){$("#planBtn").hasClass("active")&&3==e.index&&e.cancel()}),n()},200)}),e.check_type=function(t,n){var a=angular.element(event.target);a.toggleClass("active"),e.filters.type[n]=e.filters.type[n]&&"undefined"!==e.filters.type[n]?!1:!0,e.changed()},e.check_direction=function(t,n){var a=angular.element(event.target);a.toggleClass("active"),e.filters.direction[n]=e.filters.direction[n]&&"undefined"!==e.filters.direction[n]?!1:!0,e.changed()},e.filterByArea=function(t){return e.filters.area.max>t.score&&t.score>e.filters.area.min?!0:!1},e.filterByType=function(t){return e.filters.type[t.type]||a(e.filters.type)},e.filterByDirection=function(t){return e.filters.direction[t.direction]||a(e.filters.direction)},e.changed=function(){setTimeout(function(){o.find("li").stop(),o.masonry("reload")},600)},e.trigger_modal=function(a){$("#modal").addClass("active"),e.modalopen=!0,setTimeout(function(){e.modal=e.plans.data[a],n(),t(e.modal.src)},300)},e.close_modal=function(){$("#modal").removeClass("active"),e.modalopen=!1,$("#canvas").removeClass("active")}}]);