App.controller("ViewController",["$scope","$filter",function(e){function t(){p=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e3),l=new THREE.Scene,e.views=[{url:"img/view/"+e.view.path+"/pz.jpg",position:[-448,0,0],rotation:[0,Math.PI/2,0]},{url:"img/view/"+e.view.path+"/nx.jpg",position:[448,0,0],rotation:[0,-Math.PI/2,0]},{url:"img/view/"+e.view.path+"/ny.jpg",position:[0,448,0],rotation:[Math.PI/2,0,Math.PI]},{url:"img/view/"+e.view.path+"/py.jpg",position:[0,-448,0],rotation:[-Math.PI/2,0,Math.PI]},{url:"img/view/"+e.view.path+"/nz.jpg",position:[0,0,448],rotation:[0,Math.PI,0]},{url:"img/view/"+e.view.path+"/px.jpg",position:[0,0,-448],rotation:[0,0,0]}];for(var t=0;t<e.views.length;t++){var a=e.views[t],o=document.createElement("img");o.width=900,o.src=a.url,M[t]=new THREE.CSS3DObject(o),M[t].position.fromArray(a.position),M[t].rotation.fromArray(a.rotation),l.add(M[t])}m=new THREE.CSS3DRenderer,m.setSize(window.innerWidth,window.innerHeight-47),$("#ViewRenderer").html(m.domElement),L.addEventListener("mousedown",i,!1),L.addEventListener("touchstart",r,!1),L.addEventListener("touchmove",s,!1),L.addEventListener("gesturechange",v,!1),L.addEventListener("mousewheel",d,!1),window.addEventListener("resize",n,!1)}function n(){p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight-47)}function i(e){e.preventDefault(),L.addEventListener("mousemove",a,!1),L.addEventListener("mouseup",o,!1)}function a(e){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0;H-=.5*t}function o(){L.removeEventListener("mousemove",a),L.removeEventListener("mouseup",o)}function r(e){e.preventDefault();var t=e.touches[0];I=t.screenX}function s(e){e.preventDefault();var t=e.touches[0];H-=.5*(t.screenX-I),I=t.screenX}function d(e){e.preventDefault();var t=p.fov-.05*e.wheelDeltaY;t=g>t?g:t>E?E:t,p.fov=t,p.updateProjectionMatrix()}function v(e){var t=p.fov-(e.scale-1);t=g>t?g:t>E?E:t,p.fov=t,p.updateProjectionMatrix()}function c(){e.auto&&(H+=.1),j=Math.max(-85,Math.min(85,j)),C=THREE.Math.degToRad(90-j),F=THREE.Math.degToRad(H),f.x=Math.sin(C)*Math.cos(F),f.y=Math.cos(C),f.z=Math.sin(C)*Math.sin(F);var t=parseFloat(R.data("deg")+(H-90));R.css("transform","rotate("+t+"deg)")}function w(){c(),requestAnimationFrame(w),p.lookAt(f),u()}function u(){m.render(l,p)}function h(){cancelAnimationFrame(w),H=90,F=0;for(var t=0;t<e.views.length;t++)l.remove(M[t])}var p,l,m,f=new THREE.Vector3,g=30,E=70,M=[];e.auto=!0;var R=$(".beam"),P=[{path:"a-15-night",title:"15F 夜景"},{path:"a-15",title:"15F"},{path:"a-13",title:"13F"},{path:"a-10",title:"10F"},{path:"a-8",title:"8F"},{path:"a-5",title:"5F"},{path:"a-2",title:"2F"}],H=90,j=0,C=0,F=0;e.view=P[0],e.view_paths=P;var I,L=document.getElementById("ViewRenderer");ons.ready(function(){e.imgPreload,t(),w(),tabbar.on("prechange",function(e){$("#viewBtn").hasClass("active")&&2==e.index&&e.cancel()})}),e.switchView=function(n){$(".side").find(".side-list-item .svg-wrapper").removeClass("active"),$("#ViewRenderer").stop().fadeOut("fast",function(){$(".side").find(".side-list-item").eq(n).find(".svg-wrapper").addClass("active"),e.view=P[n],h(),t(),$("#ViewRenderer").fadeIn("fast")})},e.sideClose=function(){$(".side,.btn-close").toggleClass("close")},e.switch_auto=function(){$(".btn-animate").toggleClass("active"),e.auto=e.auto?!1:!0},e.preImage=function(){}}]);